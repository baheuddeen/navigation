// <!-- Product Cookie Tracker for Hotjar Recordings -->
// Set hotjar heatmap if user hasn't been cookied by product
// https://stackoverflow.com/questions/10730362/get-cookie-by-name
function getCookie(name) {
  var value = "; " + document.cookie;
  var parts = value.split("; " + name + "=");
  if (parts.length == 2) return parts.pop().split(";").shift();
}

// if user is not cookied by product trigger heatmap
function runHotjar() {
  console.log("running hotjar");
  var myCookie = getCookie("on-session-id");
  if (myCookie == undefined) {
    console.log("executing no cookie trigger");
    hj('trigger', 'exclude-signin-users');
  }
  else {
    console.log("cookie found");
  }
}

var fragmentToLoad = $('[data-include]').length;
var fragmentLoaded = 0;

function fragment(el, url) {
  var localTest = /^(?:file):/,
    xmlhttp = new XMLHttpRequest(),
    status = 0;
  xmlhttp.onreadystatechange = function () {
    /* if we are on a local protocol, and we have response text, we'll assume
*  				things were sucessful */
    if (xmlhttp.readyState == 4) {
      status = xmlhttp.status;
    }
    if (localTest.test(location.href) && xmlhttp.responseText) {
      status = 200;
    }
    if (xmlhttp.readyState == 4 && status == 200) {
      el.html(xmlhttp.responseText);


      fragmentLoaded++;

      if (fragmentLoaded === fragmentToLoad) {
        runFragmentScripts();
        nav_menu(0);
      }
    }
  }

  try {
    xmlhttp.open("GET", url, true);
    xmlhttp.send();
  } catch (err) {
    /* todo catch error */
  }

}

function runFragmentScripts() {
  // Mobile Menu
  if (!($(".os-lp").length)) {
    // var logo = $('.osh-logo').html();
    // var mm_m_menu = "<ul class='mm-main-menu'><li class='hs-menu-item hs-menu-depth-1'><a href='/'>Home</a></li>" + $('.osh-mm .hs-menu-wrapper>ul').html() + "</ul>";
    // var accounts_links = $('.osh-ctas').html();
    // var mobilemenu_acc_links = "<div class='mm-account-links'>" + accounts_links + "</div>";
    // var mobilemenu = $("<div class='mm-items'></div>");
    // var mobilemenu_bottom = $("<div class='mm-bottom'></div>");
    // var mobilemenu_container = $("<div></div>");
    // mobilemenu.html( mm_m_menu );
    // mobilemenu_container.addClass("mobile-menu");
    // mobilemenu_container.append('<a class="mm-logo" href="/">'+logo + '</a><i class="close-menu"></i>');
    // mobilemenu_container.append(mobilemenu_acc_links);
    // mobilemenu_container.append(mobilemenu);
    // mobilemenu_container.append(mobilemenu_bottom);
    // $('body').prepend(mobilemenu_container);

    // $('.mobile-menu li.hs-item-has-children').prepend('<i></i>');
    // $('.mobile-menu .active-branch').addClass('expanded');
    // $('.mobile-menu .active-branch>ul').slideDown();

    // $('.mobile-menu li.hs-item-has-children > i').click(function(){
    //   $(this).parent().siblings().removeClass('expanded');
    //   $(this).parent().siblings().find('.expanded').removeClass('expanded');
    //   $(this).parent().siblings().find("ul").slideUp(); 
    //   if($(this).parent().hasClass("expanded")){
    //     $(this).parent().removeClass("expanded");
    //   }else{
    //     $(this).parent().addClass("expanded");
    //   }
    //   $(this).parent().find(">ul").slideToggle(); 
    // });

    // $('.mobile-menu .close-menu').click(function() {
    //   $('.mobile-menu').removeClass('slide');
    //   $('body').removeClass('show-mobile-menu');
    // });

    // Search & Language Switcher Actions
    $('.osh-search').hover(
      function () {
        $('.osh-search input').focus();
      }, function () {
        $('.osh-search input').blur();
      }
    );

    // Search & Language Switcher Actions
    $('.osh-search-2').hover(
      function () {
        $('.osh-search-2 input').focus();
      }, function () {
        $('.osh-search-2 input').blur();
      }
    );




    if ($('.osh-lang').length) {
      $('.mobile-menu').addClass('v2');
    }

    // Mobile Triggers
    // var menu_trigger = $('<div class="mobile-menu-trigger"><label></label><span></span></div>');
    // menu_trigger.click(function(){
    //   $('.mobile-menu').addClass("slide");
    //   $('body').addClass('show-mobile-menu');
    // });
    // // Mobile Triggers....continued
    // $('body').prepend(menu_trigger);

    function resizeHeader() {
      var scrollVal = $(this).scrollTop();
      var windowWidth = $(window).width();
      if (scrollVal > 0) {
        $('body').addClass('scroll-resize');
      } else {
        $('body').removeClass('scroll-resize');
      }
    }
    resizeHeader();
    $(window).bind('orientationchange', function (event) {
      resizeHeader();
    });
    $(window).scroll(function () {
      resizeHeader();
    });
    $(window).resize(function () {
      resizeHeader();
    });
  }
}


$(document).ready(function () {

  $('[data-include]').each(function () {
    fragment($(this), $(this).data('include'));
  });


});


$(document).mouseup(function (e) {
  var container = $(".mobile-menu");
  if (!container.is(e.target) // if the target of the click isn't the container...
    && container.has(e.target).length === 0) // ... nor a descendant of the container
  {
    $('body').removeClass('show-mobile-menu');
    $('.mobile-menu').removeClass('slide');
  }
  if ($('.smenu-mobile.expanded').length) {
    var smenu_mobile_container = $(".smenu-mobile");
    if (!smenu_mobile_container.is(e.target) // if the target of the click isn't the container...
      && smenu_mobile_container.has(e.target).length === 0) // ... nor a descendant of the container
    {
      $('.smenu-items').slideUp();
      $('.smenu-mobile .smenu-active-item i').toggleClass('fa-chevron-down fa-chevron-up');
      $('.smenu-mobile').toggleClass('expanded');
    }
  }
});

$(document).keyup(function (e) {
  if (e.keyCode == 27) {
    $('body').removeClass('show-mobile-menu');
    $('.mobile-menu').removeClass('slide');
  }
});


  nav_menu = function(n) {
    n +=1 ;
    console.log("try");
    console.log(n);
    const mobileMenuBtn = document.querySelector('.osh-mm-mobil-menu-btn button');
    const mobileMenuClose = document.querySelector('.osh-mm-close button');
    const menuCollabsable = document.querySelector('.osh-mm-collabsable');
  if(mobileMenuBtn){
      // toggle menu view on mobile

    mobileMenuBtn.addEventListener('click', function() {
      if (menuCollabsable.classList.contains('slide-in')) {
        menuCollabsable.classList.remove('slide-in');
      } else {
        menuCollabsable.classList.add('slide-in');
      }
    });

    mobileMenuClose.addEventListener('click', function() {
      menuCollabsable.classList.remove('slide-in');
    });
    $('.dropdown-arrow').on('click',function(){
      if($(window).width() < 767){
        console.log($(this).next())
      $(this).next().toggleClass('d-none');
      if ($('.menu-title-wrapper').hasClass('d-none')) {
        $('.menu-title-wrapper').removeClass('d-none');
        $('.menu-title').text($(this).text());
        $('.osh-mm-close').addClass('title-added');
        $('.osh-ctas-new.v2').addClass('d-none');
        $('.osh-mm-nav').addClass('sub-opened');
        $(this).closest('ul').addClass('show-sub-menu');
        $(this).closest('.hs-menu-item').addClass('is-shown')
      }else{
        $('.menu-title-wrapper').addClass('d-none');
        $('.osh-mm-close').removeClass('title-added');
        $('.osh-ctas-new.v2').removeClass('d-none');
        $('.osh-mm-nav').removeClass('sub-opened');
        $(this).closest('ul').removeClass('show-sub-menu');
        $(this).closest('.hs-menu-item').removeClass('is-shown')
      }
      
     
      }
  
    });
    $('.close-menu').on('click',function(){
      if($(window).width() < 767){
        $('.dropdown-content').each(function(){
          $(this).addClass('d-none')
        })
        $('.menu-title-wrapper').addClass('d-none');
        $('.osh-mm-close').removeClass('title-added');
        $('.osh-ctas-new.v2').removeClass('d-none');
        $('.osh-mm-nav').removeClass('sub-opened');
        $('.show-sub-menu').removeClass('show-sub-menu');
        $('.is-shown').removeClass('is-shown')
      }
    });
  }
  else {
    if (n==10) {
      return;
    }
    else{
      setTimeout(() => {
        nav_menu(n);
      }, 500);
    }      
  }
  
  if ($(window).width() > 767) {
    if($('.dropdown').length > 0){
      $('.dropdown').each(function () {
        console.log("succedded");
        $(this).click(
          function(){
            $(this).find('.dropdown-content').toggleClass('d-none');
            $(this).toggleClass('open');
            if($(this).siblings().find('.dropdown-content').length > 0){
              $(this).siblings().find('.dropdown-content').addClass('d-none')
              $(this).siblings().removeClass('open')
            }
          });
      });
    
    $('.dropdown-content').each(function(){
      $(this).click(function(event){
        event.stopPropagation();
      });
    });
    
    $('.nav-list-item').each(function(n1){
      if ($(window).width() > 767) {
        $(this).hover(function(event){
          $('.nav-list-item-des').each(function (n2){
            (n1 == n2) ? $(this).removeClass('d-none') : $(this).addClass('d-none');
          });
        });
      }
     
    });
    
    $('.resource-item').each(function(n1){
      $(this).click(function(){
        $('.resource-card').each(function (n2){
          (n1 == n2) ? $(this).removeClass('d-none') : $(this).addClass('d-none');
          });
      });
    });

    $('.new-mob-btn-menu, .close-mob-menu').click(()=>{
      $('.new-mob-menu').toggleClass('open');
    })
    }
    else{
      if (n==10) {
        return;
      }
      else{
        setTimeout(() => {
          nav_menu(n);
        }, 500);       }
     
    }
  }
  
  

}


